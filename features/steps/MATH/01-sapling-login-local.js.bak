const path = require('path');
var Imap = require('imap')
var simpleParser = require("mailparser").simpleParser;
const { Given, When, Then, After } = require('cucumber');
const { loadConfig, loadLogin } = require('../../../app/util');
const expect = require('chai')
const stepsPath = process.cwd() + '/features/pageDefs/';
const { PageObject } = require('../../../app/pageObject');
const chromePath = require('chromedriver').path;
const { log } = require('../../../app/logger');
const { getDriver, sleep } = require('../../../app/driver');
const { By } = require('selenium-webdriver');â€©
const config = loadConfig('config');

let pages = {
    docker_ams: new PageObject('math-sapl-localLogin.json',stepsPath),
};

Given(/^The local docker "(.*)" page is loaded$/, async function(urlKey) {
    const amsUrl = config[urlKey];
    console.log(`Loading url, ${amsUrl}`);
    // log.debug(`Loading url, ${amsUrl}`)
    await getDriver().get(amsUrl);
});

When (/^I login as "(.*)"$/, async function(user) {
    log.debug("The local docker url is loaded ");
    await sleep(2000);
    const account = await loadLogin(user)
    await pages.docker_ams.populate('username', account.username);
    await pages.docker_ams.populate('password', account.password);
    log.debug('Clicking Sapling login button');
    await sleep(2000)
    await pages.docker_ams.checkWebElementExists('saplogin');
    await pages.docker_ams.populate('saplogin', 'click');
});

Then(/^Verify I can signin successfully$/, async function(){
    await sleep(3000)
    await pages.docker_ams.populate('amslink', 'click');
    await sleep(3000);
});